<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>T·∫°o L·ªô Tr√¨nh Ri√™ng - SaiGonGo</title>
  <link rel="stylesheet" href="./assets/css/style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./assets/css/lotrinh_SAME_style.css" />
  <style>
    /* --- GI·ªÆ NGUY√äN CSS CHUNG C·ª¶A D·ª∞ √ÅN --- */
    body {
      font-family: "Times New Roman", serif;
      background-color: #f8f8f8;
      text-align: center;
      padding-top: 50px; 
    }

    .header {
        background-color: var(--primary-color);
        padding: 15px 0;
        position: fixed;
        top: 0;
        width: 100%;
        z-index: 1000;
        box-shadow: var(--shadow-header);
    }

    .main-container {
      max-width: 1000px; /* R·ªông h∆°n ch√∫t ƒë·ªÉ ch·ª©a l∆∞·ªõi ·∫£nh */
      margin: 40px auto;
      padding: 30px;
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    .btn-action {
      background-color: #d62828;       
      color: #fff;                     
      padding: 18px 50px;              
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1.4rem;               
      font-weight: 800;
      letter-spacing: 0.5px;
      transition: all 0.25s ease;
      margin-top: 25px;
      box-shadow: 0 4px 14px rgba(214, 40, 40, 0.4); 
    }

    .btn-action:hover {
      background-color: #e63946;       
      transform: translateY(-3px);     
      box-shadow: 0 6px 18px rgba(230, 57, 70, 0.5);
    }

    .btn-action:disabled {
        background-color: #ccc;
        cursor: not-allowed;
        box-shadow: none;
        transform: none;
    }

    /* --- CSS CHO GRID ƒê·ªäA ƒêI·ªÇM (M·ªöI) --- */
    .location-grid {
        display: grid;
        /* T·ª± ƒë·ªông chia c·ªôt, m·ªói c·ªôt t·ªëi thi·ªÉu 220px */
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); 
        gap: 20px;
        margin-top: 30px;
        text-align: left;
    }

    /* Th·∫ª bao quanh m·ªói ƒë·ªãa ƒëi·ªÉm */
    .location-card {
        position: relative;
        cursor: pointer;
        border-radius: 15px;
        overflow: hidden;
        transition: all 0.3s ease;
        border: 3px solid transparent; /* Vi·ªÅn trong su·ªët m·∫∑c ƒë·ªãnh */
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        background: #fff;
    }

    /* ·∫®n checkbox m·∫∑c ƒë·ªãnh ƒëi */
    .location-card input[type="checkbox"] {
        display: none; 
    }

    /* H√¨nh ·∫£nh ƒë·ªãa ƒëi·ªÉm */
    .location-card img {
        width: 100%;
        height: 160px;
        object-fit: cover;
        display: block;
        transition: transform 0.3s ease;
    }

    /* T√™n ƒë·ªãa ƒëi·ªÉm b√™n d∆∞·ªõi ·∫£nh */
    .location-name {
        padding: 15px;
        font-weight: 700;
        font-size: 1.1rem;
        color: #333;
        text-align: center;
        background-color: #fff;
    }

    /* --- HI·ªÜU ·ª®NG KHI ƒê∆Ø·ª¢C CH·ªåN (CHECKED) --- */
    
    /* Khi checkbox ƒë∆∞·ª£c check, ƒë·ªïi m√†u vi·ªÅn c·ªßa Card cha */
    .location-card:has(input:checked) {
        border-color: #007bff; /* Vi·ªÅn xanh d∆∞∆°ng */
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 123, 255, 0.3);
    }

    /* Khi check, th√™m d·∫•u t√≠ch xanh */
    .location-card:has(input:checked)::after {
        content: "‚úÖ";
        position: absolute;
        top: 10px;
        right: 10px;
        background: white;
        border-radius: 50%;
        padding: 5px;
        font-size: 1.2rem;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    @keyframes popIn {
        0% { transform: scale(0); }
        100% { transform: scale(1); }
    }

    /* Loading Spinner */
    #loadingOverlay {
        display: none;
        margin-top: 20px;
        font-size: 1.2rem;
        color: #007bff;
        font-weight: 600;
    }
  </style>
</head>

<body id="top">
    <header class="header" data-header>
        <div class="container">
            <a href="index.html">
              <h1 class="logo">SaiGonGo</h1>
            </a>
        </div>
    </header>

    <main class="main-container">
        <h2 style="font-size: 2.2rem; color: #0056b3; font-weight: 800; text-transform: uppercase;">
            ‚ú® Thi·∫øt K·∫ø H√†nh Tr√¨nh
        </h2>
        <p style="font-size: 1.2rem; color: #555; margin-top: 10px;">
            Ch·ªçn √≠t nh·∫•t <b>2 ƒë·ªãa ƒëi·ªÉm</b> b·∫°n mu·ªën ƒëi, AI s·∫Ω s·∫Øp x·∫øp ƒë∆∞·ªùng ƒëi ng·∫Øn nh·∫•t cho b·∫°n.
        </p>

        <div class="location-grid">
            
            <label class="location-card">
                <input type="checkbox" name="destinations" value="dinh_doc_lap">
                <img src="./assets/images/DinhDocLap.jpg" alt="Dinh ƒê·ªôc L·∫≠p">
                <div class="location-name">Dinh ƒê·ªôc L·∫≠p</div>
            </label>

            <label class="location-card">
                <input type="checkbox" name="destinations" value="nha_tho_duc_ba">
                <img src="./assets/images/NhaThoDucBa.jpg" alt="Nh√† th·ªù ƒê·ª©c B√†">
                <div class="location-name">Nh√† th·ªù ƒê·ª©c B√†</div>
            </label>

            <label class="location-card">
                <input type="checkbox" name="destinations" value="ho_con_rua">
                <img src="./assets/images/HoConRua.jpg" alt="H·ªì Con R√πa">
                <div class="location-name">H·ªì Con R√πa</div>
            </label>

            <label class="location-card">
                <input type="checkbox" name="destinations" value="buu_dien_thanh_pho">
                <img src="./assets/images/BuuDienTP.png" alt="B∆∞u ƒëi·ªán TP">
                <div class="location-name">B∆∞u ƒëi·ªán Th√†nh Ph·ªë</div>
            </label>

            <label class="location-card">
                <input type="checkbox" name="destinations" value="bao_tang_chien_tich">
                <img src="./assets/images/BTCTCT.png" alt="B·∫£o t√†ng Chi·∫øn t√≠ch">
                <div class="location-name">B·∫£o t√†ng Chi·∫øn t√≠ch chi·∫øn tranh</div>
            </label>

            <label class="location-card">
                <input type="checkbox" name="destinations" value="cho_ben_thanh">
                <img src="./assets/images/ChoBenThanh.jpg" alt="Ch·ª£ B·∫øn Th√†nh">
                <div class="location-name">Ch·ª£ B·∫øn Th√†nh</div>
            </label>

            </div>

        <br>
        <button id="createBtn" class="btn-action" onclick="createTour()">
            üöÄ T·∫°o L·ªô Tr√¨nh Ngay
        </button>

        <div id="loadingOverlay">
            ‚è≥ ƒêang t√≠nh to√°n kho·∫£ng c√°ch v√† s·∫Øp x·∫øp l·ªô tr√¨nh...
        </div>

    </main>
    
    <footer class="footer" style="background-image: url('./assets/images/footer-bg.png'); min-height: 100px;">
    </footer>

    <script>
        async function createTour() {
            // 1. L·∫•y danh s√°ch c√°c √¥ ƒë√£ tick
            const checkboxes = document.querySelectorAll('input[name="destinations"]:checked');
            const selectedKeys = Array.from(checkboxes).map(cb => cb.value);
            const preference = document.getElementById('userPref').value;
            
            const btn = document.getElementById('createBtn');
            const loading = document.getElementById('loadingOverlay');

            // 2. Validate
            if (selectedKeys.length < 2) {
                alert("‚ö†Ô∏è Vui l√≤ng ch·ªçn √≠t nh·∫•t 2 ƒë·ªãa ƒëi·ªÉm ƒë·ªÉ t·∫°o th√†nh m·ªôt l·ªô tr√¨nh!");
                return;
            }

            // 3. Hi·ªáu ·ª©ng Loading
            btn.disabled = true;
            btn.style.opacity = "0.7";
            loading.style.display = "block";

            // 4. G·ª≠i l√™n Server (API b·∫°n ƒë√£ th√™m ·ªü main.py)
            try {
                const res = await fetch('/api/create-custom-tour', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        locations: selectedKeys,
                        preference: preference
                    })
                });

                const data = await res.json();

                if (data.success) {
                    // Th√†nh c√¥ng -> Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang ƒë·∫ßu ti√™n c·ªßa l·ªô tr√¨nh
                    loading.textContent = "‚úÖ ƒê√£ xong! ƒêang chuy·ªÉn h∆∞·ªõng...";
                    setTimeout(() => {
                        window.location.href = data.redirect_url;
                    }, 1000);
                } else {
                    alert("‚ùå L·ªói: " + data.message);
                    btn.disabled = false;
                    btn.style.opacity = "1";
                    loading.style.display = "none";
                }

            } catch (err) {
                console.error(err);
                alert("‚ùå L·ªói k·∫øt n·ªëi ƒë·∫øn Server.");
                btn.disabled = false;
                btn.style.opacity = "1";
                loading.style.display = "none";
            }
        }
    </script>
</body>
</html>