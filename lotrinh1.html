<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>B·∫£o t√†ng Chi·∫øn t√≠ch Chi·∫øn tranh</title>
    
    <!-- Global CSS (NEW - Helvetica font) -->
    <link rel="stylesheet" href="./assets/css/global.css" />
    <link rel="stylesheet" href="./assets/css/style.css" />
    
    <style>
        .shop-button-container {
            text-align: center;
            margin-top: 30px;
        }

        .btn-shop {
            display: inline-block;
            background-color: var(--primary-blue);
            color: var(--white);
            padding: 15px 30px;
            border-radius: var(--radius-md);
            text-decoration: none;
            font-size: var(--font-size-md);
            font-weight: 600;
            transition: background-color var(--transition-normal), transform 0.2s ease;
            box-shadow: 0 4px 8px rgba(0, 123, 255, 0.3);
        }

        .btn-shop:hover {
            background-color: var(--primary-blue-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 123, 255, 0.4);
            text-decoration: none;
            color: var(--white);
        }

        #toast-notification {
            visibility: hidden;
            min-width: 250px;
            background-color: var(--jet);
            color: var(--white);
            text-align: center;
            border-radius: var(--radius-sm);
            padding: 16px;
            position: fixed;
            z-index: 1;
            left: 50%;
            transform: translateX(-50%);
            bottom: 30px;
            font-size: var(--font-size-base);
            opacity: 0;
            transition: opacity 0.5s, bottom 0.5s;
        }

        #toast-notification.show {
            visibility: visible;
            opacity: 1;
            bottom: 50px;
        }

        .route-badge {
            display: inline-block;
            padding: 12px 30px;
            border: 3px solid #f1f1f1;
            border-radius: var(--radius-lg);
            background-color: rgb(167, 205, 246);
            box-shadow: 0 4px 10px rgba(152, 193, 236, 0.2);
            font-size: var(--font-size-2xl);
            font-weight: 800;
            color: #040c69;
            text-transform: uppercase;
        }

        .section-badge {
            display: inline-block;
            padding: 10px 25px;
            border: 2px solid var(--primary-orange);
            border-radius: var(--radius-md);
            background-color: rgba(255, 102, 0, 0.1);
            box-shadow: 0 4px 10px rgba(255, 102, 0, 0.2);
            font-size: var(--font-size-xl);
            font-weight: 800;
            color: var(--primary-orange-dark);
            margin-bottom: 25px;
        }

        .museum-section {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 40px;
            margin: 50px auto;
            max-width: 1100px;
            flex-wrap: wrap;
        }

        .museum-image {
            flex: 1;
            text-align: center;
        }

        .museum-image img {
            width: 100%;
            max-width: 480px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
        }

        .museum-info {
            flex: 1;
            min-width: 320px;
        }

        .museum-info p {
            font-size: var(--font-size-lg);
            color: #444;
            line-height: 1.8;
            text-align: justify;
        }

        .destination-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            justify-items: center;
            align-items: start;
            max-width: 900px;
            margin: 0 auto;
        }

        .destination-item {
            text-align: center;
        }

        .destination-item .img-wrapper {
            width: 100%;
            aspect-ratio: 4/3;
            overflow: hidden;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
        }

        .destination-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform var(--transition-normal);
        }

        .destination-item:hover img {
            transform: scale(1.05);
        }

        .destination-item p {
            margin-top: 12px;
            font-size: var(--font-size-base);
            color: #444;
            font-weight: 700;
        }

        .map-and-ranking {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: flex-start;
            gap: 40px;
            margin-top: 60px;
        }

        .start-point {
            flex: 1 1 500px;
            max-width: 600px;
            text-align: center;
        }

        .start-point h2 {
            font-size: var(--font-size-lg);
            color: var(--jet);
            margin-bottom: 20px;
        }

        .start-point iframe {
            border-radius: var(--radius-lg);
        }

        .start-point h3 {
            font-size: var(--font-size-lg);
            font-weight: 800;
            margin-top: 15px;
        }

        .ranking {
            flex: 1 1 300px;
            max-width: 400px;
            text-align: center;
        }

        .ranking h2 {
            font-size: var(--font-size-xl);
            color: var(--jet);
        }

        #xp-score {
            color: var(--primary-orange);
            font-weight: 600;
            font-size: var(--font-size-md);
            margin-top: 10px;
        }

        .support-box {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background-color: var(--primary-blue);
            color: var(--white);
            padding: 15px 20px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            font-size: var(--font-size-sm);
            line-height: 1.6;
            z-index: 100;
        }

        .support-box h3 {
            margin: 0 0 5px 0;
            font-size: var(--font-size-base);
            font-weight: 700;
            color: var(--white);
        }

        .support-box a {
            color: var(--white);
            font-weight: 600;
            text-decoration: underline;
        }

        .start-btn-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 99;
            text-align: center;
        }

        .start-btn-container .btn {
            background-color: var(--primary-orange);
            color: var(--white);
            padding: 20px 70px;
            border-radius: 14px;
            text-decoration: none;
            font-size: var(--font-size-lg);
            font-weight: 700;
            box-shadow: 0 4px 10px rgba(0,0,0,0.25);
            transition: all 0.25s ease;
            display: inline-block;
        }

        .start-btn-container .btn:hover {
            transform: translateY(-4px);
            background-color: var(--primary-orange-dark);
        }

        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="route-badge">L·ªô tr√¨nh 1</div>
            <a href="index.html" class="btn btn-outline">‚Üê Quay l·∫°i trang ch√≠nh</a>
        </div>
    </header>

    <main class="container">
        <section class="museum-section">
            <div class="museum-image">
                <img src="./assets/images/BTCTCT.png" alt="B·∫£o t√†ng Chi·∫øn t√≠ch Chi·∫øn tranh" />
            </div>

            <div class="museum-info">
                <h2 class="section-badge">Gi·ªõi thi·ªáu s∆° l∆∞·ª£c v·ªÅ l·ªô tr√¨nh 1</h2>

                <p>
                    L·ªô tr√¨nh s·∫Ω xu·∫•t ph√°t t·ª´ <b>B·∫£o t√†ng Chi·∫øn t√≠ch Chi·∫øn tranh</b> t·∫°i s·ªë <b>28 V√µ VƒÉn T·∫ßn, Qu·∫≠n 3, TP. H·ªì Ch√≠ Minh</b>.
                    L·∫ßn l∆∞·ª£t ƒëi qua c√°c ƒë·ªãa ƒëi·ªÉm n·ªïi b·∫≠t trong th√†nh ph·ªë nh∆∞ <b>Dinh ƒê·ªôc L·∫≠p</b>, <b>C√¥ng vi√™n 30/4</b>, <b>Nh√† th·ªù ƒê·ª©c B√†</b>, <b>B∆∞u ƒëi·ªán Th√†nh ph·ªë</b>, <b>ƒê∆∞·ªùng s√°ch Nguy·ªÖn VƒÉn B√¨nh</b>, <b>H·ªì con r√πa</b>. T·ª´ ƒë√≥, 
                    gi√∫p du kh√°ch kh√°m ph√° l·ªãch s·ª≠, vƒÉn h√≥a v√† ki·∫øn tr√∫c ƒë·ªôc ƒë√°o c·ªßa S√†i G√≤n.
                </p>
            </div>
        </section>

        <section class="next-destinations" style="text-align: center; margin-top: 60px;">
            <h2 class="section-badge">Nh·ªØng ƒë·ªãa ƒëi·ªÉm ti·∫øp theo trong l·ªô tr√¨nh</h2>

            <div class="destination-grid">
                <div class="destination-item">
                    <div class="img-wrapper">
                        <img src="./assets/images/DinhDocLap.jpg" alt="Dinh ƒê·ªôc L·∫≠p">
                    </div>
                    <p>Dinh ƒê·ªôc L·∫≠p</p>
                </div>

                <div class="destination-item">
                    <div class="img-wrapper">
                        <img src="./assets/images/cv30th4.jpg" alt="C√¥ng vi√™n 30/4">
                    </div>
                    <p>C√¥ng vi√™n 30/4</p>
                </div>

                <div class="destination-item">
                    <div class="img-wrapper">
                        <img src="./assets/images/NhaThoDucBa.jpg" alt="Nh√† th·ªù ƒê·ª©c B√†">
                    </div>
                    <p>Nh√† th·ªù ƒê·ª©c B√†</p>
                </div>

                <div class="destination-item">
                    <div class="img-wrapper">
                        <img src="./assets/images/BuuDienTP.png" alt="B∆∞u ƒëi·ªán Th√†nh ph·ªë">
                    </div>
                    <p>B∆∞u ƒëi·ªán Th√†nh ph·ªë</p>
                </div>

                <div class="destination-item">
                    <div class="img-wrapper">
                        <img src="./assets/images/DuongSachNVB.jpg" alt="ƒê∆∞·ªùng s√°ch Nguy·ªÖn VƒÉn B√¨nh">
                    </div>
                    <p>ƒê∆∞·ªùng s√°ch Nguy·ªÖn VƒÉn B√¨nh</p>
                </div>

                <div class="destination-item">
                    <div class="img-wrapper">
                        <img src="./assets/images/HoConRua.jpg" alt="H·ªì Con R√πa">
                    </div>
                    <p>H·ªì Con R√πa</p>
                </div>
            </div>
        </section>

        <section class="map-and-ranking">
            <div class="start-point">
                <h2>ƒêi·ªÉm xu·∫•t ph√°t</h2>
                <div style="width: 100%; border-radius: 12px; overflow: hidden;">
                    <iframe src="https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d7838.822421986659!2d106.689342!3d10.779784!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31752f30a23708cf%3A0x7cd94adf2b1474aa!2zQuG6o28gdMOgbmcgQ2jhu6luZyB0w61jaCBDaGnhur9uIHRyYW5o!5e0!3m2!1svi!2sus!4v1761832010042!5m2!1svi!2sus"
                            width="100%" height="350" style="border:0;" allowfullscreen="" loading="lazy"
                            referrerpolicy="no-referrer-when-downgrade"></iframe>
                </div>
                <h3>B·∫£o t√†ng Chi·∫øn t√≠ch Chi·∫øn tranh</h3>
                <p style="color: #555;">28 V√µ VƒÉn T·∫ßn, Ph∆∞·ªùng 6, Qu·∫≠n 3, TP. H·ªì Ch√≠ Minh</p>
            </div>

            <div class="ranking">
                <h2>X·∫øp h·∫°ng</h2>
                <p id="xp-score">ƒêi·ªÉm cao nh·∫•t üíé 0 XP</p>

                <div style="margin-top: 20px;">
                    <img 
                        id="treasure-chest"
                        src="./assets/images/Ruong_dong.png"
                        alt="R∆∞∆°ng kho b√°u ƒë√≥ng"
                        data-closed-src="./assets/images/Ruong_dong.png"
                        data-open-src="./assets/images/Ruong.jpeg"
                        style="max-width: 250px; cursor: pointer;"
                    />
                </div>

                <div class="shop-button-container">
                    <a href="shop.html" class="btn-shop">üõçÔ∏è ƒê·ªïi Voucher</a>
                </div>
            </div>
        </section>

        <hr style="margin: 40px 0; border: 0.5px solid #ddd;">

        <section class="support-box">
            <h3>üìû H·ªó tr·ª£</h3>
            <p>
                Email: <a href="mailto:hello@ontripquest.com">hello@ontripquest.com</a><br>
                Hotline: <a href="tel:0906488443">0906 488 443</a>
            </p>
        </section>

        <div class="start-btn-container">
            <a href="batdau1.html" class="btn">üöÄ B·∫Øt ƒë·∫ßu</a>
        </div>
    </main>

    <div id="toast-notification">ƒê√¢y l√† th√¥ng b√°o c·ªßa b·∫°n!</div>
    
    <script>
        const chestImage = document.getElementById('treasure-chest');
        const toast = document.getElementById('toast-notification');
        const xpScoreElement = document.getElementById('xp-score');
        
        const closedSrc = chestImage.getAttribute('data-closed-src');
        const openSrc = chestImage.getAttribute('data-open-src');
        
        let isRouteCompleted = false;
        let isRewardClaimed = false;

        window.addEventListener('load', async () => {
            try {
                const res = await fetch('/api/user');
                const data = await res.json();
                
                if (data.logged_in) {
                    const route1 = data.routes && data.routes['route1'];
                    
                    if (route1 && route1.status === 'completed') {
                        isRouteCompleted = true;
                        isRewardClaimed = route1.reward_claimed;

                        if (isRewardClaimed) {
                            chestImage.src = openSrc;
                            chestImage.style.cursor = 'default';
                            xpScoreElement.textContent = `ƒêi·ªÉm hi·ªán t·∫°i üíé ${data.points} XP`;
                        } else {
                            chestImage.style.cursor = 'pointer';
                            chestImage.style.animation = 'shake 0.5s infinite'; 
                        }
                    } else {
                        chestImage.style.filter = "grayscale(100%)";
                        chestImage.style.cursor = "not-allowed";
                        chestImage.title = "B·∫°n c·∫ßn ho√†n th√†nh l·ªô tr√¨nh ƒë·ªÉ m·ªü kh√≥a!";
                    }
                }
            } catch (e) { console.error(e); }
        });

        chestImage.addEventListener('click', async () => {
            if (!isRouteCompleted) {
                showToast("üîí H√£y ho√†n th√†nh h·∫øt c√°c ƒë·ªãa ƒëi·ªÉm ƒë·ªÉ m·ªü kh√≥a r∆∞∆°ng!");
                return;
            }

            if (isRewardClaimed) {
                showToast("B·∫°n ƒë√£ nh·∫≠n qu√† c·ªßa l·ªô tr√¨nh n√†y r·ªìi!");
                return;
            }

            try {
                const res = await fetch('/api/claim-reward', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ routeId: 'route1', points: 50 })
                });
                
                const data = await res.json();
                
                if (data.success) {
                    chestImage.src = openSrc;
                    chestImage.style.animation = 'none';
                    
                    xpScoreElement.textContent = `ƒêi·ªÉm hi·ªán t·∫°i üíé ${data.newPoints} XP`;
                    showToast(`üéâ Xu·∫•t s·∫Øc! B·∫°n nh·∫≠n ƒë∆∞·ª£c 50 XP!`);
                    
                    isRewardClaimed = true;
                } else {
                    showToast(data.message);
                }
            } catch (e) {
                console.error(e);
                showToast("L·ªói k·∫øt n·ªëi server");
            }
        });

        function showToast(message) {
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => { toast.classList.remove('show'); }, 3000);
        }
    </script>
</body>
</html>