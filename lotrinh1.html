<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title data-i18n="dest_museum">B·∫£o t√†ng Chi·∫øn t√≠ch Chi·∫øn tranh</title>
    <link rel="stylesheet" href="./assets/css/style.css" />
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>

        body {
            font-family: "Times New Roman", Times, serif;
        }
        /* Th√™m CSS cho n√∫t shop */
        .shop-button-container {
            text-align: center;
            margin-top: 30px; /* Kho·∫£ng c√°ch t·ª´ r∆∞∆°ng */
        }

        .btn-shop {
            display: inline-block;
            background-color: #007bff; /* M√†u xanh d∆∞∆°ng */
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            text-decoration: none;
            font-size: 1.1rem;
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 8px rgba(0, 123, 255, 0.3); /* B√≥ng ƒë·ªï nh·∫π */
        }

        .btn-shop:hover {
            background-color: #0056b3; /* M√†u xanh ƒë·∫≠m h∆°n khi hover */
            transform: translateY(-2px); /* N√∫t nh√≠ch l√™n nh·∫π */
            box-shadow: 0 6px 12px rgba(0, 123, 255, 0.4);
        }

        /* CSS cho toast notification (n·∫øu ch∆∞a c√≥ trong style.css) */
        #toast-notification {
            visibility: hidden; /* ·∫®n theo m·∫∑c ƒë·ªãnh */
            min-width: 250px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 5px;
            padding: 16px;
            position: fixed;
            z-index: 1;
            left: 50%;
            transform: translateX(-50%);
            bottom: 30px;
            font-size: 17px;
            opacity: 0;
            transition: opacity 0.5s, bottom 0.5s;
        }

        #toast-notification.show {
            visibility: visible;
            opacity: 1;
            bottom: 50px;
        }


    </style>
</head>
<body>
    <header class="header">
  <div class="container">
    <div style="
        display: inline-block;
        padding: 12px 30px;
        border: 3px solid #f1f1f1;
        border-radius: 12px;
        background-color: rgb(167, 205, 246);
        box-shadow: 0 4px 10px rgba(152, 193, 236, 0.2);
        font-size: 2.4rem;
        font-weight: 800;
        color: #040c69;
        text-transform: uppercase;
        font-family: 'Times New Roman', Times, serif;
      " data-i18n="dest_route_1">
      L·ªô tr√¨nh 1
    </div>
    
    <a href="index.html" class="btn btn-outline" data-i18n="btn_back_home">‚Üê Quay l·∫°i trang ch√≠nh</a>
  </div>
</header>

    <main class="container">
        <section class="museum-section" style="display: flex; align-items: center; justify-content: center; gap: 40px; margin: 50px auto; max-width: 1100px; flex-wrap: wrap;">
            <div class="museum-image" style="flex: 1; text-align: center;">
                <img
                    src="./assets/images/BTCTCT.png"
                    data-i18n-alt="dest_museum"
                    alt="B·∫£o t√†ng Chi·∫øn t√≠ch Chi·∫øn tranh"
                    style="
                        width: 100%;
                        max-width: 480px;
                        border-radius: 12px;
                        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
                    "
                />
            </div>

            <div class="museum-info" style="flex: 1; min-width: 320px;">
                <h2 style="
                  display: inline-block;
                  padding: 10px 25px;
                  border: 2px solid #ff6600;
                  border-radius: 10px;
                  background-color: rgba(255, 102, 0, 0.1);
                  box-shadow: 0 4px 10px rgba(255, 102, 0, 0.2);
                  font-size: 2rem;
                  font-weight: 800;
                  color: #e65c00;
                  margin-bottom: 25px;
                  font-family: 'Times New Roman', Times, serif;
                  " data-i18n="route1_intro_title">
                  Gi·ªõi thi·ªáu s∆° l∆∞·ª£c v·ªÅ l·ªô tr√¨nh 1
                </h2>

                <p style="font-size: 1.6rem; color: #444; line-height: 1.8; text-align: justify;" data-i18n="route1_intro_text">
                </p>
            </div>
        </section>

        <section class="next-destinations" style="text-align: center; margin-top: 60px;">
            <h2 style="
                  display: inline-block;
                  padding: 10px 25px;
                  border: 2px solid #ff6600;
                  border-radius: 10px;
                  background-color: rgba(255, 102, 0, 0.1);
                  box-shadow: 0 4px 10px rgba(255, 102, 0, 0.2);
                  font-size: 2rem;
                  font-weight: 800;
                  color: #e65c00;
                  margin-bottom: 25px;
                  font-family: 'Times New Roman', Times, serif;
                  " data-i18n="route1_next_dest_title">
                  Nh·ªØng ƒë·ªãa ƒëi·ªÉm ti·∫øp theo trong l·ªô tr√¨nh
                </h2>

  <div class="destination-grid" style="
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 30px;
    justify-items: center;
    align-items: start;
    max-width: 900px;
    margin: 0 auto;
  ">

    <div class="destination-item" style="text-align: center;">
      <div style="
        width: 100%;
        aspect-ratio: 4/3;
        overflow: hidden;
        border-radius: 12px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      ">
        <img src="./assets/images/DinhDocLap.jpg" data-i18n-alt="dest_palace" alt="Dinh ƒê·ªôc L·∫≠p" style="
          width: 100%;
          height: 100%;
          object-fit: cover;
          transition: transform 0.3s ease;
        ">
      </div>
      <p style="margin-top: 12px; font-size: 1.05rem; color: #444; font-weight: 700;" data-i18n="dest_palace">Dinh ƒê·ªôc L·∫≠p</p>
    </div>

    <div class="destination-item" style="text-align: center;">
      <div style="
        width: 100%;
        aspect-ratio: 4/3;
        overflow: hidden;
        border-radius: 12px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      ">
        <img src="./assets/images/cv30th4.jpg" data-i18n-alt="dest_park" alt="C√¥ng vi√™n 30/4" style="
          width: 100%;
          height: 100%;
          object-fit: cover;
          transition: transform 0.3s ease;
        ">
      </div>
      <p style="margin-top: 12px; font-size: 1.05rem; color: #444; font-weight: 700;" data-i18n="dest_park">C√¥ng vi√™n 30/4</p>
    </div>

    <div class="destination-item" style="text-align: center;">
      <div style="
        width: 100%;
        aspect-ratio: 4/3;
        overflow: hidden;
        border-radius: 12px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      ">
        <img src="./assets/images/NhaThoDucBa.jpg" data-i18n-alt="dest_cathedral" alt="Nh√† th·ªù ƒê·ª©c B√†" style="
          width: 100%;
          height: 100%;
          object-fit: cover;
          transition: transform 0.3s ease;
        ">
      </div>
      <p style="margin-top: 12px; font-size: 1.05rem; color: #444; font-weight: 700;" data-i18n="dest_cathedral">Nh√† th·ªù ƒê·ª©c B√†</p>
    </div>

    <div class="destination-item" style="text-align: center;">
      <div style="
        width: 100%;
        aspect-ratio: 4/3;
        overflow: hidden;
        border-radius: 12px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      ">
        <img src="./assets/images/BuuDienTP.png" data-i18n-alt="dest_post_office" alt="B∆∞u ƒëi·ªán Th√†nh ph·ªë" style="
          width: 100%;
          height: 100%;
          object-fit: cover;
          transition: transform 0.3s ease;
        ">
      </div>
      <p style="margin-top: 12px; font-size: 1.05rem; color: #444; font-weight: 700;" data-i18n="dest_post_office">B∆∞u ƒëi·ªán Th√†nh ph·ªë</p>
    </div>

    <div class="destination-item" style="text-align: center;">
      <div style="
        width: 100%;
        aspect-ratio: 4/3;
        overflow: hidden;
        border-radius: 12px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      ">
        <img src="./assets/images/DuongSachNVB.jpg" data-i18n-alt="dest_book_street" alt="ƒê∆∞·ªùng s√°ch Nguy·ªÖn VƒÉn B√¨nh" style="
          width: 100%;
          height: 100%;
          object-fit: cover;
          transition: transform 0.3s ease;
        ">
      </div>
      <p style="margin-top: 12px; font-size: 1.05rem; color: #444; font-weight: 700;" data-i18n="dest_book_street">ƒê∆∞·ªùng s√°ch Nguy·ªÖn VƒÉn B√¨nh</p>
    </div>

    <div class="destination-item" style="text-align: center;">
      <div style="
        width: 100%;
        aspect-ratio: 4/3;
        overflow: hidden;
        border-radius: 12px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      ">
        <img src="./assets/images/HoConRua.jpg" data-i18n-alt="dest_turtle_lake" alt="H·ªì Con R√πa" style="
          width: 100%;
          height: 100%;
          object-fit: cover;
          transition: transform 0.3s ease;
        ">
      </div>
      <p style="margin-top: 12px; font-size: 1.05rem; color: #444; font-weight: 700;" data-i18n="dest_turtle_lake">H·ªì Con R√πa</p>
    </div>

  </div>
</section>

        <section class="map-and-ranking"
         style="display: flex; flex-wrap: wrap; justify-content: center; align-items: flex-start; gap: 40px; margin-top: 60px;">
    
  <div class="start-point" style="flex: 1 1 500px; max-width: 600px; text-align: center;">
    <h2 style="font-size: 1.6rem; color: #222; margin-bottom: 20px;" data-i18n="route1_start_point">ƒêi·ªÉm xu·∫•t ph√°t</h2>
    <div style="width: 100%; border-radius: 12px; overflow: hidden;">
      <iframe src="https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d7838.822421986659!2d106.689342!3d10.779784!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31752f30a23708cf%3A0x7cd94adf2b1474aa!2zQuG6o28gdMOgbmcgQ2jhu6luZyB0w61jaCBDaGnhur9uIHRyYW5o!5e0!3m2!1svi!2sus!4v1761832010042!5m2!1svi!2sus"
              width="100%" height="350" style="border:0;" allowfullscreen="" loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"></iframe>
    </div>
    <div style="margin-top: 15px;">
      <h3 style="font-size: 1.2rem; font-weight: 800;" data-i18n="dest_museum">B·∫£o t√†ng Chi·∫øn t√≠ch Chi·∫øn tranh</h3>
      <p style="color: #555;" data-i18n="addr_museum">28 V√µ VƒÉn T·∫ßn, Ph∆∞·ªùng 6, Qu·∫≠n 3, TP. H·ªì Ch√≠ Minh</p>
    </div>
  </div>

  <div class="ranking" style="flex: 1 1 300px; max-width: 400px; text-align: center;">
    <h2 style="font-size: 1.5rem; color: #222;" data-i18n="route1_ranking">X·∫øp h·∫°ng</h2>
    <p id="xp-score" style="color: #ff6b00; font-weight: 600; font-size: 1.1rem; margin-top: 10px;">
        <span data-i18n="score_highest">ƒêi·ªÉm cao nh·∫•t</span> üíé 0 XP
    </p>

    <div style="margin-top: 20px;">
      <img 
        id="treasure-chest"
        src="./assets/images/Ruong_dong.png"
        data-i18n-alt="chest_closed"
        alt="R∆∞∆°ng kho b√°u ƒë√≥ng"
        data-closed-src="./assets/images/Ruong_dong.png"
        data-open-src="./assets/images/Ruong.jpeg"
        style="max-width: 250px;"
      />
    </div>

    <div class="shop-button-container" style="margin-top: 25px;">
      <a href="shop.html" class="btn-shop"
         style="display: inline-block; background-color: #007bff; color: white; padding: 12px 25px; border-radius: 10px; text-decoration: none; font-weight: 600;"
         data-i18n="btn_exchange_voucher">
        üõçÔ∏è ƒê·ªïi Voucher
      </a>
    </div>
  </div>
</section>

        <hr style="margin: 40px 0; border: 0.5px solid #ddd;">

        <section class="support" 
                 style="
                   position: fixed;
                   bottom: 20px;
                   left: 20px;
                   background-color: #007bff;
                   color: white;
                   padding: 15px 20px;
                   border-radius: 12px;
                   box-shadow: 0 4px 10px rgba(0,0,0,0.2);
                   font-size: 0.95rem;
                   line-height: 1.6;
                   z-index: 100;
                 ">
            <h3 style="margin: 0 0 5px 0; font-size: 1.05rem; font-weight: 700;" data-i18n="route1_support">üìû H·ªó tr·ª£</h3>
            <p style="margin: 0;">
              Email: <a href="mailto:hello@ontripquest.com" style="color: #fff; font-weight: 600; text-decoration: underline;">hello@ontripquest.com</a><br>
              Hotline: <a href="tel:0906488443" style="color: #fff; font-weight: 600; text-decoration: underline;">0906 488 443</a>
            </p>
        </section>

         <div style="
          position: fixed;
          bottom: 20px;
          left: 50%;
          transform: translateX(-50%);
          z-index: 99;
          text-align: center;
        ">
            <a href="batdau1.html" class="btn btn-primary"
               style="
                 background-color: #ff6600;
                 color: white;
                 padding: 20px 70px;
                 border-radius: 14px;
                 text-decoration: none;
                 font-size: 1.4rem;
                 font-weight: 700;
                 box-shadow: 0 4px 10px rgba(0,0,0,0.25);
                 transition: all 0.25s ease;
                 display: inline-block;
               "
               onmouseover="this.style.transform='translateY(-4px)'"
               onmouseout="this.style.transform='translateY(0)'"
               data-i18n="btn_start"
            >
                üöÄ B·∫Øt ƒë·∫ßu
            </a>
        </div>
    </main>

    <div id="toast-notification" data-i18n="route1_toast_default">ƒê√¢y l√† th√¥ng b√°o c·ªßa b·∫°n!</div>

<script>
    const chestImage = document.getElementById('treasure-chest');
    const toast = document.getElementById('toast-notification');
    const xpScoreElement = document.getElementById('xp-score');
    
    const closedSrc = chestImage.getAttribute('data-closed-src');
    const openSrc = chestImage.getAttribute('data-open-src');
    
    let isRouteCompleted = false;
    let isRewardClaimed = false;

    // 1. Khi load trang, ki·ªÉm tra tr·∫°ng th√°i t·ª´ Server
    window.addEventListener('load', async () => {
        try {
            const res = await fetch('/api/user');
            const data = await res.json();
            
            if (data.logged_in) {
                const route1 = data.routes && data.routes['route1'];
                
                if (route1 && route1.status === 'completed') {
                    isRouteCompleted = true;
                    isRewardClaimed = route1.reward_claimed;

                    if (isRewardClaimed) {
                        // N·∫øu ƒë√£ nh·∫≠n th∆∞·ªüng r·ªìi -> Hi·ªán r∆∞∆°ng m·ªü lu√¥n
                        chestImage.src = openSrc;
                        chestImage.style.cursor = 'default';
                        // Update text using i18n logic (manual for dynamic content)
                        const scoreCurrentText = i18n.t('score_current');
                        xpScoreElement.innerHTML = `${scoreCurrentText} üíé ${data.points} XP`;
                    } else {
                        // N·∫øu ƒë√£ xong nh∆∞ng ch∆∞a m·ªü -> R∆∞∆°ng ƒë√≥ng, hi·ªáu ·ª©ng rung l·∫Øc m·ªùi g·ªçi
                        chestImage.style.cursor = 'pointer';
                        chestImage.style.animation = 'shake 0.5s infinite'; 
                    }
                } else {
                    // Ch∆∞a xong l·ªô tr√¨nh
                    chestImage.style.filter = "grayscale(100%)"; // L√†m x√°m r∆∞∆°ng
                    chestImage.style.cursor = "not-allowed";
                    chestImage.title = i18n.t('route1_chest_locked');
                }
            }
        } catch (e) { console.error(e); }
    });

    // 2. X·ª≠ l√Ω click r∆∞∆°ng
    chestImage.addEventListener('click', async () => {
        if (!isRouteCompleted) {
            showToast(i18n.t('route1_chest_locked'));
            return;
        }

        if (isRewardClaimed) {
            showToast(i18n.t('route1_chest_claimed'));
            return;
        }

        // G·ªçi API nh·∫≠n th∆∞·ªüng
        try {
            const res = await fetch('/api/claim-reward', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ routeId: 'route1', points: 50 })
            });
            
            const data = await res.json();
            
            if (data.success) {
                // Hi·ªáu ·ª©ng m·ªü r∆∞∆°ng
                chestImage.src = openSrc;
                chestImage.style.animation = 'none'; // T·∫Øt rung
                
                // C·∫≠p nh·∫≠t giao di·ªán
                const scoreCurrentText = i18n.t('score_current');
                xpScoreElement.innerHTML = `${scoreCurrentText} üíé ${data.newPoints} XP`;
                showToast(i18n.t('route1_chest_reward'));
                
                isRewardClaimed = true;
            } else {
                showToast(data.message);
            }
        } catch (e) {
            console.error(e);
            showToast(i18n.t('status_connection_error'));
        }
    });

    function showToast(message) {
        toast.textContent = message;
        toast.classList.add('show');
        setTimeout(() => { toast.classList.remove('show'); }, 3000);
    }
</script>

<style>
@keyframes shake {
  0% { transform: translate(1px, 1px) rotate(0deg); }
  10% { transform: translate(-1px, -2px) rotate(-1deg); }
  20% { transform: translate(-3px, 0px) rotate(1deg); }
  30% { transform: translate(3px, 2px) rotate(0deg); }
  40% { transform: translate(1px, -1px) rotate(1deg); }
  50% { transform: translate(-1px, 2px) rotate(-1deg); }
  60% { transform: translate(-3px, 1px) rotate(0deg); }
  70% { transform: translate(3px, 1px) rotate(-1deg); }
  80% { transform: translate(-1px, -1px) rotate(1deg); }
  90% { transform: translate(1px, 2px) rotate(0deg); }
  100% { transform: translate(1px, -2px) rotate(-1deg); }
}
</style>

<script src="./assets/js/translations.js"></script>
<script src="./assets/js/i18n.js"></script>
<link rel="stylesheet" href="./assets/js/i18n.css">

</body>
</html>